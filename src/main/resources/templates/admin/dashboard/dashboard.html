<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Qu·∫£n Tr·ªã</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/styles/sidebar.css}"/>
    <style>
        .page-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="bg-dark text-white p-3" style="width: 250px;">
            <div th:replace="fragments/sidebar :: sidebar"></div>
        </div>

        <div class="col-md-10 mt-4">
            <div class="alert alert-info" th:if="${session.user != null and session.user.role.roleId != 'admin'}">
                B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p trang n√†y !!!
            </div>

            <div th:if="${session.user != null and session.user.role.roleId == 'admin'}">
                <div class="page-header">
                    <h2>üìä Th·ªëng k√™ t·ªïng quan</h2>
                </div>

                <!-- Cards -->
                <div class="row g-4 mb-4">
                    <div class="col-md-3">
                        <div class="card text-bg-primary shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">Ng∆∞·ªùi d√πng</h5>
                                <p class="card-text fs-3" th:text="${totalUsers}">0</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="card text-bg-success shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">ƒê∆°n b√°n</h5>
                                <p class="card-text fs-3" th:text="${totalSalesOrders}">0</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="card text-bg-warning shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">Phi·∫øu nh·∫≠p</h5>
                                <p class="card-text fs-3" th:text="${totalStockInwards}">0</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="card text-bg-info shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">T·ªïng t·ªìn kho</h5>
                                <p class="card-text fs-3" th:text="${totalInventoryQuantity}">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-bg-info shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">T·ªïng s·∫£n ph·∫©m</h5>
                                <p class="card-text fs-3" th:text="${totalProducts}">0</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="card text-bg-warning shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">S·∫Øp h·∫øt h√†ng</h5>
                                <p class="card-text fs-3" th:text="${lowStockCount}">0</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="card text-bg-danger shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">H·∫øt h√†ng</h5>
                                <p class="card-text fs-3" th:text="${outOfStockCount}">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chart: ƒê∆°n b√°n + ƒê∆°n mua -->
                <div class="chart-container shadow-sm">
                    <h5>üì¶ Bi·ªÉu ƒë·ªì ƒë∆°n b√°n & ƒë∆°n mua (30 ng√†y)</h5>
                    <canvas id="orderChart" width="400" height="150"></canvas>
                </div>

                <!-- Chart: Quantity on Hand -->
                <div class="chart-container shadow-sm">
                    <h5>üìâ Bi·∫øn ƒë·ªông t·ªìn kho theo th·ªùi gian (30 ng√†y)</h5>
                    <canvas id="inventoryChart" width="400" height="150"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
    const orderLabels = /*[[${orderChartLabels}]]*/ [];
    const salesData = /*[[${salesOrderData}]]*/ [];
    const purchaseData = /*[[${stockInwardData}]]*/ [];

    const inventoryLabels = /*[[${inventoryChartLabels}]]*/ [];
    const inventoryData = /*[[${inventoryQuantityData}]]*/ [];

    // Chart 1: ƒê∆°n b√°n v√† ƒë∆°n mua
    new Chart(document.getElementById('orderChart'), {
        type: 'bar',
        data: {
            labels: orderLabels,
            datasets: [
                {
                    label: 'ƒê∆°n b√°n',
                    backgroundColor: '#28a745',
                    data: salesData
                },
                {
                    label: 'ƒê∆°n mua',
                    backgroundColor: '#ffc107',
                    data: purchaseData
                }
            ]
        },
        options: {
            responsive: true,
            plugins: { legend: { position: 'top' } },
            scales: { y: { beginAtZero: true } }
        }
    });

    // Chart 2: T·ªìn kho
    new Chart(document.getElementById('inventoryChart'), {
        type: 'line',
        data: {
            labels: inventoryLabels,
            datasets: [{
                label: 'T·ªìn kho',
                data: inventoryData,
                fill: false,
                borderColor: '#007bff',
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { position: 'top' } },
            scales: { y: { beginAtZero: true } }
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
